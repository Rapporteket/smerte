---
params:
  title: ': oversikt over PROM-skjema i perioden '
  author: 'Rapporteket'
  hospitalName: 'Ukjent sykehus'
  reshId: 'locallyDefined'
  userRole: 'MyRole'
  userFullName: 'Ukjent bruker'
  startDate: '2017-01-01'
  endDate: '2017-12-31'
  year: '2016'
  tableFormat: 'html'
  registryName: 'rapbase'
  shinySession: list()
title: '`r paste0("Smerteregisteret ", params$hospitalName, params$title, params$startDate, " til ", params$endDate)`'
author: '`r params$author`'
date: '`r format(Sys.time(), "%d\\. %B, %Y")`'
reglogo: '`r system.file("www/logoSmerte.png", package = "smerte")`'
regtext: '`r readLines(system.file("registryShortDescription.txt", package = "smerte"))`'
registryName: Smerteregisteret
userFullName: '`r params$userFullName`'
---
```{r set options and load packages, include = FALSE}
knitr::opts_chunk$set(echo=FALSE)
options(knitr.table.format = params$tableFormat)
options(tinytex.verbose = TRUE)
```

```{r get data, include=FALSE}

if (rapbase::isRapContext()) {
  dat <- smerte::getDataDump(registryName = params$registryName,
                             tableName = "AlleVarNum",
                             fromDate = params$startDate,
                             toDate = params$endDate,
                             session = params$shinySession)
} else {
  #Dataimport: skal hente lokale data for hvert sykehus (tar vekk sti, og erstatter med lokal filB)
  path <- read.csv(file = "H:/path.csv", header = FALSE, sep = ";")
  path <- as.data.frame(lapply(path, as.character), stringsAsFactors=FALSE)
  path <- path$V1
  dat <- read.csv(file = path, header = TRUE, sep = ";")
 }

dataPresent <- TRUE
if(dim(dat)[1] < 1) {
  dataPresent <- FALSE
}

```


# Innledning
I denne rapporten finner vi en oversikt over besvarelsene som er gitt via PROM, både andelen som besvarer og grunnene som er oppgitt til at besvarelse mangler. I tillegg vises det hvordan svarene fordeler seg på de ulike spørsmålene for hvert skjema. Det er for tiden fire PROM-skjema som vises her. Disse er: _pasreg_, _evaluering_, _HADS_ og _opioid_. 

Mange av resultatene presenteres i tabeller. Her vises også andelen som har gitt de ulike svarene. I de tilfellene der andelen ikke summeres til 100\% er dette fordi den "manglende" prosenten er fjernet fra oversikten (grunnet manglende besvarelse og lignende).

En periode kunne man dele ut pasientregistreringsskjema til pasienter selv om de ikke hadde samtykket fra før. Dersom man valgte å ikke dele ut pasientregistreringsskjemaene ved manglende samtykke, krysset man av for "Annet" under "Årsak til manglende utfylling". Derfor vil en del av annet-kategoriene som vises være store.

```{r noData, eval=!dataPresent, results='asis'}
cat('# Upps...\nI den valgte tidsperioden er det ikke nok data til å gi 
    ut resultater.')
knitr::knit_exit()
```


\twocolumn

# ePROM: pasreg

```{r pasreg, warning = TRUE, message=TRUE, results='asis', eval=dataPresent}
###Dette er oversikten for pasregskjemaet
  
#Antall som har fått tilsendt skjema
antUtsendt <- sum(!is.na(dat$PasDelUfylPR))
#Antall som ikke har fått tilsendt skjema
antIkkeUtsendt <- sum(is.na(dat$PasDelUfylPR))
#Antall som svarte
antsvar <- sum(dat$PasDelUfylPR == 1, na.rm =TRUE)
antiksvar <- sum(dat$PasDelUfylPR == 0, na.rm =TRUE)

#Finner svarandel, men tar høyde for at vi ikke kan dele på 0
andsvar <- NA
if(antUtsendt != 0){
  andsvar <- antsvar/antUtsendt
}else{andsvar <- paste0("ikke mulig å angi andel grunnet ingen utsendte 
                        skjema.")}
```

I den valgte tidsperioden fikk tilsammen `r antUtsendt` pasienter av totalt `r dim(dat)[1]` tilsendt ePROM-skjema for pasreg. Av de som fikk tilsendt skjema var det `r antsvar` pasienter som sendte inn en besvarelse. Dette gir en svarandel på `r round(andsvar, digits = 2)`. Tabell \@ref(tab:tabPR) gir en oversikt over registrerte årsaker til manglende besvarelse for de `r antiksvar` som ikke har svart.

```{r tabPR, eval=dataPresent, results='asis'}
#Fjerner først de som ikke har fått tilsendt (null) 3 = null
datpr <- dat[!is.na(dat$PasDelUfylPR), ]
#Bruker her pakkene dplyr og magrittr
pasreg <- datpr %>% 
  count(GrunnManglUtfyl) %>%
  mutate(prosent = round(100*(n/sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
pasreg = pasreg %>%
  mutate(grunnPR = case_when(GrunnManglUtfyl == 1 ~ "Tidsmangel behandler",
                             GrunnManglUtfyl == 2 ~ "Tidlig utskrivning",
                             GrunnManglUtfyl == 3 ~ "Kritisk syk/død",
                             GrunnManglUtfyl == 4 ~ "Pasient klarer ikke",
                             GrunnManglUtfyl == 5 ~ "Manglende samtykke",
                             GrunnManglUtfyl == 7 ~ "Ikke besvart ePPROMS",
                             GrunnManglUtfyl == 9 ~ "Annet"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
pasreg <- pasreg[1:(dim(pasreg)[1]-1), c(4,2,3)]

#Bruker pakke kableextra
rapbase::mst(
  tab = pasreg, 
    col_names = c("", "Antall ", "Prosent"),
    cap = "Årsak til manglende utfylling",
    label = "tabPR",
    type = params$tableFormat,
    digs = 0,
    align = c("l", "r", "r", "r"))
```


```{r prspm1, eval=dataPresent, results='asis'}

###PRSPM1
#Fjerner først de som ikke har fått tilsendt (null) 3 = null
ispr1 <- sum(!is.na(dat$PRSpm1))
datpr1 <- dat[!is.na(dat$PRSpm1), ]
#Bruker her pakkene dplyr og magrittr
pr1 <- datpr1 %>% 
  count(PRSpm1) %>% 
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
pr1 = pr1 %>%
  mutate(sovnfor = case_when(PRSpm1 == 1 ~ "Ikke i det hele tatt",
                             PRSpm1 == 2 ~ "I liten grad",
                             PRSpm1 == 3 ~ "I noen grad",
                             PRSpm1 == 4 ~ "I stor grad",
                             PRSpm1 == 5 ~ "I svært stor grad",
                             PRSpm1 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
pr1 <- pr1[ , c(4, 2, 3)]

rapbase::mst(
  tab = pr1,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Søvnproblemer før innleggelse"),
     label = "prspm1",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```

Tabell \@ref(tab:prspm1) viser oversikten over søvnproblemer før innleggelse for de `r dim(datpr1)[1]` pasientene som besvarte spørsmålet.

```{r pr2chunck, eval=dataPresent, results='asis'}
###PRSPM2
#Fjerner først de som ikke har fått tilsendt 
ispr2 <- sum(!is.na(dat$PRSpm2))
datpr2 <- dat[!is.na(dat$PRSpm2), ]
#Bruker her pakkene dplyr og magrittr
pr2 <- datpr2 %>% count(PRSpm2) %>% mutate(prosent = round(100*(n/sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
pr2 = pr2 %>%
  mutate(sovnfor = case_when(PRSpm2 == 1 ~ "Ikke i det hele tatt",
                             PRSpm2 == 2 ~ "I liten grad",
                             PRSpm2 == 3 ~ "I noen grad",
                             PRSpm2 == 4 ~ "I stor grad",
                             PRSpm2 == 5 ~ "I svært stor grad",
                             PRSpm2 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
pr2 <- pr2[ , c(4, 2, 3)]

rapbase::mst(tab = pr2,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Søvnproblemer etter innleggelse"),
     label = "prspm2",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:prspm2) viser oversikten over søvnproblemer etter innleggelse for de `r dim(datpr2)[1]` pasientene som besvarte spørsmålet.


```{r kontaktfig, echo=FALSE, warning = FALSE, eval=dataPresent, fig.align='center', out.width='90%', fig.cap="Antall ganger i kontakt med primær- og spesialisthelsetjenesten på grunn av smerter siste år."}

###PRSPM3
#Fjerner først de som ikke har fått tilsendt (null) 3 = null
ispr3 <- sum(!is.na(dat$PRSpm3))
datpr3 <- dat[!is.na(dat$PRSpm3), ]
#Bruker her pakkene dplyr og magrittr og ggplot
ggplot(datpr3, aes(x=PRSpm3)) +
  geom_histogram(binwidth=10, boundary=0, fill = "darkgrey", closed="left") +
    scale_x_continuous(minor_breaks = 2) +
  xlab("Antall kontakter") + ylab("Antall pasienter")
```


Figur \@ref(fig:kontaktfig) viser oversikten over hvor mange ganger pasientene har vært i kontakt med primær- og spesialisthelsetjenesten på grunn av smerter siste år for totalt `r dim(datpr3)[1]` pasienter. 

```{r pr4chunck, eval=dataPresent, results='asis'}
###PRSPM4
ispr4 <- sum(!is.na(dat$PRSpm4))
datpr4 <- dat[!is.na(dat$PRSpm4), ]
#Bruker her pakkene dplyr og magrittr
pr4 <- datpr4 %>%
  count(PRSpm4) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
pr4 = pr4 %>%
  mutate(psyk = case_when(PRSpm4 == 0 ~ "Nei",
                          PRSpm4 == 1 ~ "Ja",
                          PRSpm4 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
pr4 <- pr4[ , c(4, 2, 3)]

rapbase::mst(tab = pr4,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Har tidligere opplevd belastninger som har krevd ",
                  "behandling av psykolog/psykiater"),
     label = "prsmp4",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:prsmp4) viser oversikten over hvor mange av pasientene som tidligere har opplevd belastninger som har krevd behandling av psykolog/psykiater eller liknende for de `r dim(datpr4)[1]` pasientene som besvarte spørsmålet.

```{r pr5chunck, eval=dataPresent, results='asis'}

###PRSpm5
#Fjerner først de som ikke har fått tilsendt (null) 3 = null
ispr5 <- sum(!is.na(dat$PRSpm5))
datpr5 <- dat[!is.na(dat$PRSpm5), ]
#Bruker her pakkene dplyr og magrittr
pr5 <- datpr5 %>%
  count(PRSpm5) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
pr5 = pr5 %>%
  mutate(forferd = case_when(PRSpm5 == 0 ~ "Aldri",
                             PRSpm5 == 1 ~ "Nesten aldri",
                             PRSpm5 == 2 ~ "Sjelden",
                             PRSpm5 == 3 ~ "Av og til",
                             PRSpm5 == 4 ~ "Ofte",
                             PRSpm5 == 5 ~ "Nesten alltid", 
                             PRSpm5 == 6 ~ "Alltid",
                             PRSpm5 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
pr5 <- pr5[ , c(4, 2, 3)]

rapbase::mst(tab = pr5,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Svar på spørsmålet: ... er det forferdelig, og jeg føler ",
                  "at det aldri kommer til å bli bedre"),
     label = "prspm5",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:prspm5) viser oversikten over hvor ofte pasientene føler '... det er forferdelig, og jeg at det aldri kommer til å bli bedre'. `r dim(datpr5)[1]` pasienter besvarte spørsmålet.

```{r pr6chunck, eval=dataPresent, results='asis'}

###PRSpm6
#Fjerner først de som ikke har fått tilsendt (null) 3 = null
ispr6 <- sum(!is.na(dat$PRSpm6))
datpr6 <- dat[!is.na(dat$PRSpm6), ]
#Bruker her pakkene dplyr og magrittr
pr6 <- datpr6 %>%
  count(PRSpm6) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
pr6 = pr6 %>%
  mutate(holdut = case_when(PRSpm6 == 0 ~ "Aldri",
                            PRSpm6 == 1 ~ "Nesten aldri",
                            PRSpm6 == 2 ~ "Sjelden",
                            PRSpm6 == 3 ~ "Av og til",
                            PRSpm6 == 4 ~ "Ofte",
                            PRSpm6 == 5 ~ "Nesten alltid",
                            PRSpm6 == 6 ~ "Alltid",
                            PRSpm6 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
pr6 <- pr6[ , c(4, 2, 3)]

rapbase::mst(tab = pr6, col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Svar på spørsmålet: ... føles det som om jeg ikke holder ",
                  "ut"),
     label = "prspm6",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:prspm6) viser oversikten over hvor ofte pasientene føler '... det er som om jeg ikke holder ut'. `r dim(datpr6)[1]` pasienter besvarte spørsmålet.


# ePROM: HADS

```{r hads, warning = FALSE, eval=dataPresent, message=FALSE, results='asis'}
  
#Antall som har fått tilsendt skjema
antUtsendt <- sum(dat$PasDelUtf == 1, na.rm = TRUE) + sum(dat$PasDelUtf == 0, na.rm = TRUE)
#Antall som ikke har fått tilsendt skjema
antIkkeUtsendt <- sum(is.na(dat$PasDelUtf))
#Antall som svarte
antsvar <- sum(dat$PasDelUtf == 1, na.rm =TRUE)
antiksvar <- sum(dat$PasDelUtf == 0, na.rm =TRUE)

#Finner svarandel, men tar høyde for at vi ikke kan dele på 0 (aka ingen skjema sendt ut)
andsvar <- NA
if(antUtsendt != 0){
  andsvar <- antsvar/antUtsendt
}else{andsvar <- paste0("ikke mulig å angi andel grunnet ingen utsendte skjema.")}

#Fjerner først de som ikke har fått tilsendt (null) 3 = null
datH <- dat[!is.na(dat$PasDelUtf), ]
#Bruker her pakkene dplyr og magrittr
hads <- datH %>%
  count(GrManglUtfylHADS) %>%
  mutate(prosent = round(100 * (n / sum(n))))

#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
hads = hads %>%
  mutate(grunnHADS = case_when(GrManglUtfylHADS == 1 ~ "Tidsmangel behandler",
                               GrManglUtfylHADS == 2 ~ "Tidlig utskrivning",
                               GrManglUtfylHADS == 3 ~ "Kritisk syk/død",
                               GrManglUtfylHADS == 4 ~ "Pasient klarer ikke",
                               GrManglUtfylHADS == 5 ~ "Manglende samtykke",
                               GrManglUtfylHADS == 7 ~ "Ikke besvart ePPROMS",
                               GrManglUtfylHADS == 9 ~ "Annet"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
hads <- hads[1:(dim(hads)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = hads, col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Grunn manglende utfylling HADS"),
     label = "hadsspm",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))


#Tabeller som viser oversiktene over score
tabdep <- dat %>%
  filter(!is.na(HADSScoreDepresjon)) %>%
  count(HADSScoreDepresjon) %>% group_by(HADSScoreDepresjon)

rapbase::mst(tab = tabdep, col_names = c("Score ", "Antall"),
     cap = paste0("Resultatfordeling for HADS depresjon"),
     label = "deptab",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r"))

tabangst <- dat %>%
  filter(!is.na(HADSScoreAngst)) %>%
  count(HADSScoreAngst) %>% group_by(HADSScoreAngst)

rapbase::mst(tab = tabangst, col_names = c("Score ", "Antall"),
     cap = paste0("Resultatfordeling for HADS angst"),
     label = "angsttab",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r"))
```
I den valgte tidsperioden fikk tilsammen `r antUtsendt` pasienter av totalt `r dim(dat)[1]` tilsendt ePROM-skjema for HADS. Av de som fikk tilsendt skjema var det `r antsvar` pasienter som sendte inn en besvarelse. Dette gir en svarandel på `r round(andsvar, digits = 2)`. Tabell \@ref(tab:hadsspm) gir en oversikt over registrerte årsaker til manglende besvarelse for de `r antiksvar` som ikke har svart.

Tabell \@ref(tab:deptab) viser en oversikt over hvordan poengsummene for depresjonsdelen av HADS fordeler seg, mens tabell \@ref(tab:angsttab) gjør det samme for angstdelen av HADS.

\onecolumn

```{r hadsfig, echo=FALSE, warning = FALSE, eval=dataPresent, fig.align='center', out.width='100%', fig.cap="Fordeling av angst og depresjonsscore i HADS. Poengscorene vurderes som følger: lavere enn den grønne linjen viser ingen tegn til symptomer, mellom den grønne og den gule linjen viser milde symptomer, mellom den gule og den røde linjen viser moderate symptomer, mens over den røde viser alvorlig symptomer."}

#Figur for depresjonscore
dep = dat %>%
  select(HADSScoreDepresjon) %>%
  filter(!is.na(HADSScoreDepresjon))

depplot = depplot = ggplot(dep, aes(x=HADSScoreDepresjon)) +
  geom_histogram(binwidth=5, boundary=0, fill = "darkgrey", closed="left") +
  scale_x_continuous(minor_breaks = 2) +
  xlab("HADS: Depresjonsscore")+ylab("Antall\nforløp") +
  geom_vline(xintercept = 11, linetype="dotted", 
                color = "darkgreen", size=1) + 
  geom_vline(xintercept = 14, linetype="dotted", 
                color = "orange", size=1) + 
  geom_vline(xintercept = 17, linetype="dotted", 
                color = "red", size=1)
#Figur for angstscore
angst = dat %>%
  select(HADSScoreAngst) %>%
  filter(!is.na(HADSScoreAngst))

angstplot = ggplot(angst, aes(x=HADSScoreAngst)) +
  geom_histogram(binwidth=5, boundary=0, fill="darkgrey", closed="left") +
  scale_x_continuous(minor_breaks = 2) +
  xlab("HADS: Angstscore")+ylab("Antall\nforløp") +
  geom_vline(xintercept = 11, linetype="dotted", 
                color = "darkgreen", size=1) + 
  geom_vline(xintercept = 14, linetype="dotted", 
                color = "orange", size=1) + 
  geom_vline(xintercept = 17, linetype="dotted", 
                color = "red", size=1) 

grid.arrange(depplot, angstplot, ncol=2)
```


\twocolumn


Figur \@ref(fig:hadsfig) viser viser hvordan de `r antsvar` aktuelle forløpene fordeles på depresjonsscore og angstscore i HADS. Poengscorene vurderes som følger: lavere enn den grønne linjen viser ingen tegn til symptomer, mellom den grønne og den gule linjen viser milde symptomer, mellom den gule og den røde linjen viser moderate symptomer, mens over den røde viser alvorlig symptomer.



# ePROM: Eval

```{r evalu, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Antall som har fått tilsendt skjema
antUtsendt <- sum(dat$PasdelUtfylEval == 1, na.rm = TRUE) + sum(dat$PasdelUtfylEval == 0, na.rm = TRUE)
#Antall som ikke har fått tilsendt skjema
antIkkeUtsendt <- sum(is.na(dat$PasdelUtfylEval))
#Antall som svarte
antsvar <- sum(dat$PasdelUtfylEval == 1, na.rm =TRUE)
antiksvar <- sum(dat$PasdelUtfylEval == 0, na.rm =TRUE)

#Finner svarandel, men tar høyde for at vi ikke kan dele på 0 (aka ingen skjema sendt ut)
andsvar <- NA
if(antUtsendt != 0){
  andsvar <- antsvar/antUtsendt
}else{andsvar <- paste0("ikke mulig å angi andel grunnet ingen utsendte skjema.")}

#Fjerner først de som ikke har fått tilsendt (null) 3 = null
datE <- dat[!is.na(dat$PasdelUtfylEval), ]
#Bruker her pakkene dplyr og magrittr
evalu <- datE %>%
  count(AarsakmanglUfylEval) %>%
  mutate(prosent = round(100 * (n / sum(n))))

#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
evalu = evalu %>%
  mutate(grunnEval = case_when(AarsakmanglUfylEval == 1 ~ "Tidsmangel behandler",
                               AarsakmanglUfylEval == 2 ~ "Tidlig utskrivning",
                               AarsakmanglUfylEval == 3 ~ "Kritisk syk/død",
                               AarsakmanglUfylEval == 4 ~ "Pasient klarer ikke",
                               AarsakmanglUfylEval == 5 ~ "Manglende samtykke",
                               AarsakmanglUfylEval == 6 ~ "Ikke tilstrekkelig antall tilsyn",
                               AarsakmanglUfylEval == 7 ~ "Ikke besvart ePPROMS",
                               AarsakmanglUfylEval == 9 ~ "Annet"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
evalu <- evalu[1:(dim(evalu)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = evalu, col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Grunn manglende utfylling Eval"),
     label = "evalspmtab",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))

#Huskersmerteteam
husk <- sum(datE$HuskerSmerteteam == 1, na.rm = TRUE)
huskik <- sum(datE$HuskerSmerteteam == 2, na.rm = TRUE)
huskna <- sum(is.na(datE$HuskerSmerteteam))
```
I den valgte tidsperioden fikk tilsammen `r antUtsendt` pasienter av totalt `r dim(dat)[1]` tilsendt ePROM-skjema for Eval. Av de som fikk tilsendt skjema var det `r antsvar` pasienter som sendte inn en besvarelse. Dette gir en svarandel på `r round(andsvar, digits = 2)`. Tabell \@ref(tab:evalspmtab) gir en oversikt over registrerte årsaker til manglende besvarelse for de `r antiksvar` som ikke har svart.

På spørsmålet 'Husker du at du nylig har vært i kontakt med og fått behandling av sykehusets smerteteam?' var det `r husk` pasienter som svarte ja og `r huskik` pasienter som svarte nei.


```{r eval1, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Evalspm1
eval1 <- datE %>%
  count(EvalSpm1) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval1 = eval1 %>%
  mutate(spm1 = case_when(EvalSpm1 == 1 ~ "Mye bedre",
                          EvalSpm1 == 2 ~ "Bedre",
                          EvalSpm1 == 3 ~ "Litt bedre",
                          EvalSpm1 == 4 ~ "Uendret",
                          EvalSpm1 == 5 ~ "Litt verre",
                          EvalSpm1 == 6 ~ "Verre",
                          EvalSpm1 == 7 ~ "Mye verre",
                          EvalSpm1 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval1 <- eval1[1:(dim(eval1)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval1, col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Siden oppstart av behandling fra Smerteteamet, er min ",
                  "smertetilstand blitt"),
     label = "evalspm1",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))


```
Tabell \@ref(tab:evalspm1) viser oversikten over det første spørsmålet i Eval: 'Siden oppstart av behandling fra Smerteteamet, er min smertetilstand blitt ...'.


```{r eval2, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}
#Evalspm2
eval2 <- datE %>%
  count(EvalSpm2) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval2 = eval2 %>%
  mutate(spm2 = case_when(EvalSpm2 == 1 ~ "Mye bedre",
                          EvalSpm2 == 2 ~ "Bedre",
                          EvalSpm2 == 3 ~ "Litt bedre",
                          EvalSpm2 == 4 ~ "Uendret",
                          EvalSpm2 == 5 ~ "Litt verre",
                          EvalSpm2 == 6 ~ "Verre",
                          EvalSpm2 == 7 ~ "Mye verre",
                          EvalSpm2 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval2 <- eval2[1:(dim(eval2)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval2,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Siden oppstart av behandling fra Smerteteamet, er min ",
                  "generelle tilstand blitt"),
     label = "evalspm2",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:evalspm2) viser oversikten over det andre spørsmålet i Eval: 'Siden oppstart av behandling fra Smerteteamet, er min generelle tilstand blitt ...'.

```{r eval3, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Evalspm3
eval3 <- datE %>%
  count(EvalSpm3) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval3 = eval3 %>%
  mutate(spm3 = case_when(EvalSpm3 == 1 ~ "Ikke i det hele tatt",
                          EvalSpm3 == 2 ~ "I liten grad",
                          EvalSpm3 == 3 ~ "I noen grad",
                          EvalSpm3 == 4 ~ "I stor grad",
                          EvalSpm3 == 5 ~ "I svært stor grad",
                          EvalSpm3 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval3 <- eval3[1:(dim(eval3)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval3,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Hvor fornøyd er du med ivaretakelsen fra Smerteteamet?"),
     label = "evalspm3",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:evalspm3) viser oversikten over det tredje spørsmålet i Eval: 'Hvor fornøyd er du med ivaretakelsen fra Smerteteamet?'.

```{r eval4, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Evalspm4
eval4 <- datE %>%
  count(EvalSpm4) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval4 = eval4 %>%
  mutate(spm4 = case_when(EvalSpm4 == 1 ~ "Ikke i det hele tatt",
                          EvalSpm4 == 2 ~ "I liten grad",
                          EvalSpm4 == 3 ~ "I noen grad",
                          EvalSpm4 == 4 ~ "I stor grad",
                          EvalSpm4 == 5 ~ "I svært stor grad",
                          EvalSpm4 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval4 <- eval4[1:(dim(eval4)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval4,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Snakket behandlerne i smerteteamet til deg slik at du forsto dem?"),
     label = "evalspm4",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:evalspm4) viser oversikten over det fjerde spørsmålet i Eval: 'Snakket behandlerne i smerteteamet til deg slik at du forsto dem?'.

```{r eval5, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Evalspm5
eval5 <- datE %>%
  count(EvalSpm5) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval5 <- eval5 %>%
  mutate(spm5 = case_when(EvalSpm5 == 1 ~ "Ikke i det hele tatt",
                          EvalSpm5 == 2 ~ "I liten grad",
                          EvalSpm5 == 3 ~ "I noen grad",
                          EvalSpm5 == 4 ~ "I stor grad",
                          EvalSpm5 == 5 ~ "I svært stor grad",
                          EvalSpm5 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval5 <- eval5[1:(dim(eval5)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval5,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Har du tillit til smerteteamets faglige dyktighet?"),
     label = "evalspm5",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:evalspm5) viser oversikten over det femte spørsmålet i Eval: 'Har du tillit til smerteteamets faglige dyktighet?'.

```{r eval6, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Evalspm6
eval6 <- datE %>%
  count(EvalSpm6) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval6 = eval6 %>%
  mutate(spm6 = case_when(EvalSpm6 == 1 ~ "Ikke i det hele tatt",
                          EvalSpm6 == 2 ~ "I liten grad",
                          EvalSpm6 == 3 ~ "I noen grad",
                          EvalSpm6 == 4 ~ "I stor grad",
                          EvalSpm6 == 5 ~ "I svært stor grad",
                          EvalSpm6 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval6 <- eval6[1:(dim(eval6)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval6,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Fikk du tilstrekkelig informasjon og forklaring om din ",
                  "smertetilstand?"),
     label = "evalspm6",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:evalspm6) viser oversikten over det sjette spørsmålet i Eval: 'Fikk du tilstrekkelig informasjon og forklaring om din smertetilstand?'.

```{r eval7, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Evalspm7
eval7 <- datE %>%
  count(EvalSpm7) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval7 = eval7 %>%
  mutate(spm7 = case_when(EvalSpm7 == 1 ~ "Ikke i det hele tatt",
                          EvalSpm7 == 2 ~ "I liten grad",
                          EvalSpm7 == 3 ~ "I noen grad",
                          EvalSpm7 == 4 ~ "I stor grad",
                          EvalSpm7 == 5 ~ "I svært stor grad",
                          EvalSpm7 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval7 <- eval7[1:(dim(eval7)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval7,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Opplevde du at smertebehandlingen var tilpasset din ",
                  "situasjon?"),
     label = "evalspm7",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:evalspm7) viser oversikten over det syvende spørsmålet i Eval: 'Opplevde du at smertebehandlingen var tilpasset din situasjon?'.

```{r eval8, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Evalspm8
eval8 <- datE %>%
  count(EvalSpm8) %>%
  mutate(prosent = round(100 *(n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval8 = eval8 %>%
  mutate(spm8 = case_when(EvalSpm8 == 1 ~ "Ikke i det hele tatt",
                          EvalSpm8 == 2 ~ "I liten grad",
                          EvalSpm8 == 3 ~ "I noen grad",
                          EvalSpm8 == 4 ~ "I stor grad",
                          EvalSpm8 == 5 ~ "I svært stor grad",
                          EvalSpm8 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval8 <- eval8[1:(dim(eval8)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval8,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Var du involvert i avgjørelser som angikk din ",
                  "smertebehandling?"),
     label = "evalspm8",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:evalspm8) viser oversikten over det åttende spørsmålet i Eval: 'Var du involvert i avgjørelser som angikk din smertebehandling?'.

```{r eval9, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Evalspm9
eval9 <- datE %>%
  count(EvalSpm9) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval9 = eval9 %>%
  mutate(spm9 = case_when(EvalSpm9 == 1 ~ "Ikke i det hele tatt",
                          EvalSpm9 == 2 ~ "I liten grad",
                          EvalSpm9 == 3 ~ "I noen grad",
                          EvalSpm9 == 4 ~ "I stor grad",
                          EvalSpm9 == 5 ~ "I svært stor grad",
                          EvalSpm9 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval9 <- eval9[1:(dim(eval9)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval9,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Opplevde du at smerteteamets arbeid var godt organisert?"),
     label = "evalspm9",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))

messagee9 <- paste0("For det niende spørsmålet i Eval: 'Opplevde du 
                    at smerteteamets arbeid var godt organisert?' finner vi 
                    svarene i tabellen under.")
```
Tabell \@ref(tab:evalspm9) viser oversikten over det niende spørsmålet i Eval: 'Opplevde du at smerteteamets arbeid var godt organisert?'.

```{r eval10, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Evalspm10
eval10 <- datE %>%
  count(EvalSpm10) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval10 = eval10 %>%
  mutate(spm10 = case_when(EvalSpm10 == 1 ~ "Ikke i det hele tatt",
                           EvalSpm10 == 2 ~ "I liten grad",
                           EvalSpm10 == 3 ~ "I noen grad",
                           EvalSpm10 == 4 ~ "I stor grad",
                           EvalSpm10 == 5 ~ "I svært stor grad",
                           EvalSpm10 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval10 <- eval10[1:(dim(eval10)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval10,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Var hjelpen og behandlingen du fikk av smerteteamet, alt i ",
                  "alt, tilfredsstillende?"),
     label = "evalspm10",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:evalspm10) viser oversikten over det tiende spørsmålet i Eval: 'Var hjelpen og behandlingen du fikk av smerteteamet, alt i alt, tilfredsstillende?'.

```{r eval11, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Evalspm11
eval11 <- datE %>%
  count(EvalSpm11) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
eval11 = eval11 %>%
  mutate(spm11 = case_when(EvalSpm11 == 1 ~ "Ikke i det hele tatt",
                           EvalSpm11 == 2 ~ "I liten grad",
                           EvalSpm11 == 3 ~ "I noen grad",
                           EvalSpm11 == 4 ~ "I stor grad",
                           EvalSpm11 == 5 ~ "I svært stor grad",
                           EvalSpm11 == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
eval11 <- eval11[1:(dim(eval11)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = eval11,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Mener du at du på noen måte ble feilbehandlet av ",
                  "smerteteamet?"),
     label = "evalspm11",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:evalspm11) viser oversikten over det ellevte spørsmålet i Eval: 'Mener du at du på noen måte ble feilbehandlet av smerteteamet (etter det du selv kan bedømme)?'.



# ePROM: Opioid

```{r opi, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Antall som har fått tilsendt skjema
antUtsendt <- sum(dat$PasdelUtfylOpioid == 1, na.rm = TRUE) +
  sum(dat$PasdelUtfylOpioid == 0, na.rm = TRUE)
#Antall som ikke har fått tilsendt skjema
antIkkeUtsendt <- sum(is.na(dat$PasdelUtfylOpioid))
#Antall som svarte
antsvar <- sum(dat$PasdelUtfylOpioid == 1, na.rm =TRUE)
antiksvar <- sum(dat$PasdelUtfylOpioid == 0, na.rm =TRUE)

#Finner svarandel, men tar høyde for at vi ikke kan dele på 0 (aka ingen skjema sendt ut)
andsvar <- NA
if(antUtsendt != 0) {
  andsvar <- antsvar/antUtsendt
} else {
  andsvar <- paste0("ikke mulig å angi andel grunnet ingen utsendte skjema.")
}


datO <- dat[!is.na(dat$PasdelUtfylOpioid), ]
#Bruker her pakkene dplyr og magrittr
opio <- datO %>%
  count(AarsakmanglUtfylOpioid) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
opio = opio %>%
  mutate(grunnOpi = case_when(AarsakmanglUtfylOpioid == 1 ~ "Tidsmangel behandler",
                              AarsakmanglUtfylOpioid == 2 ~ "Tidlig utskrivning",
                              AarsakmanglUtfylOpioid == 3 ~ "Kritisk syk/død",
                              AarsakmanglUtfylOpioid == 4 ~ "Pasient klarer ikke",
                              AarsakmanglUtfylOpioid == 5 ~ "Manglende samtykke",
                              AarsakmanglUtfylOpioid == 7 ~ "Ikke besvart ePPROMS",
                              AarsakmanglUtfylOpioid == 9 ~ "Annet"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
opio <- opio[1:(dim(opio)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = opio,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Grunn manglende utfylling Opioid"),
     label = "opiospmtab",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
I den valgte tidsperioden fikk tilsammen `r antUtsendt` pasienter av totalt `r dim(dat)[1]` tilsendt ePROM-skjema for Opioid. Av de som fikk tilsendt skjema var det `r antsvar` pasienter som sendte inn en besvarelse. Dette gir en svarandel på `r round(andsvar, digits = 2)`. Tabell \@ref(tab:opiospmtab) gir en oversikt over registrerte årsaker til manglende besvarelse for de `r antiksvar` som ikke har svart.

```{r utskr, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}

#Utskrevet sykehus + medikamenter etterpå
utskr <- sum(datO$Utskrevetsykehus == 1, na.rm = TRUE)
ikutskr <- sum(datO$Utskrevetsykehus == 0, na.rm = TRUE)

smet <- sum(datO$Smstilletterutskrivelse == 1, na.rm = TRUE)
iksmet <- sum(datO$Smstilletterutskrivelse == 0, na.rm = TRUE)
messageutme <- paste0("Det er ", utskr, " pasienter som svarte ja på at de 
                      er utskrevet av sykehus, mens ", ikutskr, " pasienter 
                      svarte nei. Samtidig svarer ", smet, " av de som svarte 
                      ja at de har brukt sterke smertestillende medikamenter 
                      etter at de ble skrevet ut fra sykehuset.")
```
På spørsmål om pasienten var skrevet ut av sykehus (ved besvarelse) var det `r utskr` pasienter som svarte ja, mens `r ikutskr` pasienter svarte nei. Av de som svarte ja, var det `r smet` som hadde brukt sterke smertestillende medikamenter etter at de ble skrevet ut fra sykehuset, mens `r iksmet` svarte nei på dette.

```{r medik, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}
#Bruker tidyverse
#Lager ny data for kun de som bruker smertestillende etter utskrivelse:
datOE <- datO[datO$Smstilletterutskrivelse == 1, ]

#Medikamenter
DolcontinMalfin <- datOE %>%
  select(DolcontinMalfin) %>% 
  summarise(antja = sum(DolcontinMalfin == 1, na.rm=TRUE)) 
FentanylplDurogesicpl <- datOE %>%
  select(FentanylplDurogesicpl) %>%
  summarise(antja = sum(FentanylplDurogesicpl == 1, na.rm = TRUE)) 
Metadon <- datOE %>%
  select(Metadon) %>%
  summarise(antja = sum(Metadon == 1, na.rm = TRUE)) 
Morfin <- datOE %>%
  select(Morfin) %>%
  summarise(antja = sum(Morfin== 1, na.rm=TRUE)) 
Norspanplaster <- datOE %>%
  select(Norspanplaster) %>%
  summarise(antja = sum(Norspanplaster== 1, na.rm=TRUE)) 
OxynormOxykodon <- datOE %>%
  select(OxynormOxykodon) %>%
  summarise(antja = sum(OxynormOxykodon== 1, na.rm=TRUE)) 
OxyxontinReltebon <- datOE %>%
  select(OxyxontinReltebon) %>%
  summarise(antja = sum(OxyxontinReltebon== 1, na.rm=TRUE)) 
Palexia <- datOE %>%
  select(Palexia) %>%
  summarise(antja = sum(Palexia== 1, na.rm=TRUE)) 
PalladonHydromorfon <- datOE %>%
  select(PalladonHydromorfon) %>%
  summarise(antja = sum(PalladonHydromorfon== 1, na.rm=TRUE)) 
Paralginforte <- datOE %>%
  select(Paralginforte) %>%
  summarise(antja = sum(Paralginforte== 1, na.rm=TRUE)) 
Buprenorfin <- datOE %>%
  select(Buprenorfin) %>%
  summarise(antja = sum(Buprenorfin== 1, na.rm=TRUE)) 
Targiniq <- datOE %>%
  select(Targiniq) %>%
  summarise(antja = sum(Targiniq== 1, na.rm=TRUE)) 
Tramadolvarianter <- datOE %>%
  select(Tramadolvarianter) %>%
  summarise(antja = sum(Tramadolvarianter== 1, na.rm=TRUE)) 
Andre <- datOE %>%
  select(Andre) %>%
  summarise(antja = sum(Andre== 1, na.rm=TRUE)) 
Usikker <- datOE %>%
  select(Usikker) %>%
  summarise(antja = sum(Usikker== 1, na.rm=TRUE)) 
#Binder data sammen
datmed <- bind_rows(DolcontinMalfin, FentanylplDurogesicpl, Metadon, Morfin, 
                    Norspanplaster, OxynormOxykodon, OxyxontinReltebon, Palexia,
                    PalladonHydromorfon, Paralginforte, Buprenorfin, Targiniq, 
                    Tramadolvarianter, Andre, Usikker) %>%
  set_rownames(c("DolcontinMalfin", "FentanylplDurogesicpl", "Metadon",
                 "Morfin", "Norspanplaster", "OxynormOxykodon", 
                 "OxyxontinReltebon", "Palexia", "PalladonHydromorfon", 
                 "Paralginforte", "Buprenorfin", "Targiniq", "Tramadolvarianter",
                 "Andre", "Usikker")) %>%
  set_colnames(c("Antall ja"))

rapbase::mst(tab = datmed,
     col_names = c("Antall ja"),
     cap = paste0("Medikamenter i bruk siden utskrivelse."),
     label = "medtab",
     type = params$tableFormat,
     digs = 0,
     align = c("r", "r"))

#Bruker fortsatt noe
bruk <- datO %>%
  count(Fortsattbruk) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
bruk = bruk %>%
  mutate(brukna = case_when(Fortsattbruk == 0 ~ "Nei",
                            Fortsattbruk == 1 ~ "Ja, i samme dosering",
                            Fortsattbruk == 2 ~ "Ja, i høyere dosering",
                            Fortsattbruk == 3 ~ "Ja, i lavere dosering"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
bruk <- bruk[1:(dim(bruk)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = bruk,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Bruker du fortsatt noen av disse medikamentene?"),
     label = "medforts",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:medtab) viser en oversikt over hvilke medikamenter som har blitt brukt av pasientene etter utskrivelse, mens tabell \@ref(tab:medforts) viser hvor mange som fortsatt bruker disse medikamentene når de besvarer spørsmålet.

```{r nedtrapp, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}
#Info nedtrapping
#nedtrer her pakkene dplyr og magrittr
nedtr <- datO %>%
  count(InfoNedtrapping) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
nedtr = nedtr %>%
  mutate(infned = case_when(InfoNedtrapping == 0 ~ "Nei",
                            InfoNedtrapping == 1 ~ "Ja"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
nedtr <- nedtr[1:(dim(nedtr)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = nedtr,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Fikk du informasjon om nedtrapping av sterke smertestillende ",
                  "medikamenter?"),
     label = "infonedtab",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))

#Info hvem
hvem <- datO %>%
  count(HvemInfoNedtrapping) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
hvem <- hvem %>%
  mutate(infhvem = case_when(HvemInfoNedtrapping == 1 ~ "Smerteteam",
                             HvemInfoNedtrapping == 2 ~ "Annet helsepersonell",
                             HvemInfoNedtrapping == 3 ~ "Begge",
                             HvemInfoNedtrapping == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
hvem <- hvem[1:(dim(hvem)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = hvem,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Av hvem fikk du informasjon om nedtrapping av sterke ",
                  "smertestillende medikamenter?"),
     label = "nedtrhvem",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:infonedtab) viser om pasienten har fått informasjon om nedtrapping av sterke smertestillende medikamenter, mens tabell \@ref(tab:nedtrhvem) viser hvem som har formidlet informasjonen.

```{r skrimun, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}
#Skriftlig og muntlig beskjed
munt <- sum(datO$MuntligInfoNedtrapp == 1, na.rm = TRUE)
ikmunt <- sum(datO$MuntligInfoNedtrapp == 0, na.rm = TRUE)

skri <- sum(datO$SkriftligNedtrappingsplan == 1, na.rm = TRUE)
ikskri <- sum(datO$SkriftligNedtrappingsplan == 0, na.rm = TRUE)

brosj <- sum(datO$InfoBrosjyreNedtrapp == 1, na.rm = TRUE)
ikbrosj <- sum(datO$InfoBrosjyreNedtrapp == 0, na.rm = TRUE)


#Info fulgt nedtraping
#fulgter her pakkene dplyr og magrittr
fulgt <- datO %>%
  count(FolgeAnbefalingNedtrapp) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
fulgt <- fulgt %>%
  mutate(inffulgt = case_when(FolgeAnbefalingNedtrapp == 1 ~ "Ja",
                              FolgeAnbefalingNedtrapp == 2 ~ "Nei, lenger enn anbefalt",
                              FolgeAnbefalingNedtrapp == 3 ~ "Nei, har ikke kunnet trappe ned",
                              FolgeAnbefalingNedtrapp == 4 ~ "Ja, raskere"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
fulgt <- fulgt[1:(dim(fulgt)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = fulgt,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Klarte du å følge anbefalingene for bruk og nedtrapping av ",
                  "medikamentene?"),
     label = "nedrfulgtplan",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Det er `r munt` pasienter som har fått muntlig informasjon om nedtrapping, mens `r ikmunt` pasienter svarte at de ikke har fått det. Samtidig svarer `r skri` pasienter at de har fått skriftlig nedtrappingsplan, mens `r ikskri` svarer nei på dette. I tillegg svarer `r brosj` pasienter at de fikk utdelt infobrosjyre om nedtrapping, mens `r ikbrosj` svarer at de ikke fikk den utdelt.

Tabell \@ref(tab:nedrfulgtplan) viser hva pasientene har svart på om de klarte å følge anbefalingene for bruk og nedtrapping av medikamentene.

```{r absti, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}
#Info plagsomme abstinenser
absti <- datO %>%
  count(OpplevdAbstinenssympt) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
absti <- absti %>%
  mutate(infabsti = case_when(OpplevdAbstinenssympt == 0 ~ "Nei",
                              OpplevdAbstinenssympt == 1 ~ "Ja",
                              OpplevdAbstinenssympt == 9 ~ "Usikker"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
absti <- absti[1:(dim(absti)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = absti,
     col_names = c("", "Antall ","Prosent"),
     cap = paste0("Opplevde du plagsomme abstinenssymptomer etter ",
                  "utskrivelse?"),
     label = "abstietter",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))

#Info forstod forstodabstinenser
forstoabsti <- datO %>%
  count(ForstodAbstinenssympt) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
forstoabsti <- forstoabsti %>%
  mutate(infforstoabsti = case_when(ForstodAbstinenssympt == 0 ~ "Nei",
                                    ForstodAbstinenssympt == 1 ~ "Ja",
                                    ForstodAbstinenssympt == 9 ~ "Usikker"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
forstoabsti <- forstoabsti[1:(dim(forstoabsti)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = forstoabsti,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Forstod du at det var abstinenssymptomer?"),
     label = "abstiforstod",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))

#Info løsning
losn <- datO %>%
  count(LosningProblemAbstinens) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
losn <- losn %>%
  mutate(inflosn = case_when(LosningProblemAbstinens == 0 ~ "Nei",
                             LosningProblemAbstinens == 1 ~ "Ja",
                             LosningProblemAbstinens == 9 ~ "Usikker"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
losn <- losn[1:(dim(losn)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = losn,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Visste du hva du kunne gjøre med problemet?"),
     label = "abstilosn",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:abstietter) viser en oversikt over om pasienten har opplevd  abstinenssymptomer (svetting/frysing, uro, smerter, diaré, rennende nese) etter utskrivelse, mens tabell \@ref(tab:abstiforstod) viser om pasienten forstod at det var abstinenssymptomer eller ikke. Tabell \@ref(tab:abstilosn) viser om pasienten visste hva den kunne gjøre med problemet.


```{r trett, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}
#Info tretthet
trett <- datO %>%
  count(OpplevdPlagsomTretthet) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
trett <- trett %>%
  mutate(inftrett = case_when(OpplevdPlagsomTretthet == 0 ~ "Nei",
                              OpplevdPlagsomTretthet == 1 ~ "Ja"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
trett <- trett[1:(dim(trett)[1]-1), c(4, 2, 3)]

#tretter pakke kablextra
rapbase::mst(tab = trett,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Opplevde du plagsom tretthet eller følelse av å være ",
                  "medikamentpåvirket etter at du ble skrevet ut fra sykehuset?"),
     label = "tretth",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))

#Info trettloshet
trettlos <- datO %>%
  count(LosningProblemTretthet) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
trettlos <- trettlos %>%
  mutate(inftrettlos = case_when(LosningProblemTretthet == 0 ~ "Nei",
                                 LosningProblemTretthet == 1 ~ "Ja",
                                 LosningProblemTretthet == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
trettlos <- trettlos[1:(dim(trettlos)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = trettlos,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Visste du hva du kunne gjøre med problemet?"),
     label = "trettvisste",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))
```
Tabell \@ref(tab:tretth) viser en oversikt over spørsmålet "Opplevde du plagsom tretthet eller følelse av å være medikamentpåvirket etter at du ble skrevet ut fra sykehuset?", mens tabell \@ref(tab:trettvisste) viser om pasienten visste hva å gjøre hvis den opplevde dette.

```{r bil, warning = FALSE, message=FALSE, results='asis', eval=dataPresent}
#Bilkjøring
bil <- datO %>%
  count(InfoSmertestillBilkjoring) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
bil <- bil %>%
  mutate(infbil = case_when(InfoSmertestillBilkjoring == 0 ~ "Nei",
                            InfoSmertestillBilkjoring == 1 ~ "Ja",
                            InfoSmertestillBilkjoring == 9 ~ "Ikke aktuelt"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
bil <- bil[1:(dim(bil)[1]-1), c(4, 2, 3)]

#biler pakke kablextra
rapbase::mst(tab = bil,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Fikk du informasjon om sterke smertestillende medikamenter ",
                  "og bilkjøring?"),
     label = "sterkbil",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))

#Info hvembil
hvembil <- datO %>%
  count(HvemInfoSmertestillBilkjoring) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
hvembil <- hvembil %>%
  mutate(infhvembil = case_when(HvemInfoSmertestillBilkjoring == 1 ~ "Smerteteam",
                                HvemInfoSmertestillBilkjoring == 2 ~ "Annet helsepersonell",
                                HvemInfoSmertestillBilkjoring == 3 ~ "Begge",
                                HvemInfoSmertestillBilkjoring == 9 ~ "Vet ikke"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
hvembil <- hvembil[1:(dim(hvembil)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = hvembil,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Av hvem fikk du informasjon om sterke smertestillende ",
                  "medikamenter og bilkjøring?"),
     label = "hveminfobil",
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))

#Beskjedbil
#Skriftlig og muntlig beskjed
muntbil <- sum(datO$MuntligInfoBilkjoring == 1, na.rm = TRUE)
ikmuntbil <- sum(datO$MuntligInfoBilkjoring == 0, na.rm = TRUE)

skribil <- sum(datO$SkriftigInfoBilkjoring == 1, na.rm = TRUE)
ikskribil <- sum(datO$SkriftigInfoBilkjoring == 0, na.rm = TRUE)

brosjbil <- sum(datO$InfoBrosyjreBilkjoring == 1, na.rm = TRUE)
ikbrosjbil <- sum(datO$InfoBrosyjreBilkjoring == 0, na.rm = TRUE)



#Info spørsmål
hvorinfo <- datO %>%
  count(HenvendelseAngSmertestill) %>%
  mutate(prosent = round(100 * (n / sum(n))))
#Gi navn i stedet for tall til alternativene for tilsyn/ikke tilsyn
hvorinfo <- hvorinfo %>%
  mutate(infhvorinfo = case_when(HenvendelseAngSmertestill == 0 ~ "Nei",
                                 HenvendelseAngSmertestill == 1 ~ "Ja",
                                 HenvendelseAngSmertestill == 9 ~ "Usikker"))
#Endrer rekkefølge og tar i tilleg ved NA-raden (siste)
hvorinfo <- hvorinfo[1:(dim(hvorinfo)[1]-1), c(4, 2, 3)]

rapbase::mst(tab = hvorinfo,
     col_names = c("", "Antall ", "Prosent"),
     cap = paste0("Visste du hvor du kunne henvende deg ved spørsmål om bruk ",
                  "av de smertestillende medikamentene?"),
     type = params$tableFormat,
     digs = 0,
     align = c("l", "r", "r", "r"))


```
Tabell \@ref(tab:sterkbil) viser en oversikt over spørsmålet "Fikk du informasjon om sterke smertestillende medikamenter og bilkjøring?", mens tabell \@ref(tab:hveminfobil) viser hvem som formidlet denne informasjonen.

Det er `r muntbil` pasienter som har fått muntlig informasjon om medikamenter og bilkjøring, mens `r ikmuntbil` pasienter har svart at de ikke har fått det. Samtidig svarer `r skribil` pasienter at de har fått skriftlig info om medikamenter og bilkjøring, mens `r ikskribil` svarer nei på dette. I tillegg svarer `r brosjbil` pasienter at de har fått utdelt infobrosjyre «Sterke smertestillende – informasjon om kortvarig bruk og nedtrapping», mens `r ikbrosjbil` svarer at de ikke fikk den utdelt.
